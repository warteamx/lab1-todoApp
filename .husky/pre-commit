#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Skip pre-commit checks in CI environment (including semantic-release)
if [ "$CI" = "true" ] || [ "$GITHUB_ACTIONS" = "true" ]; then
  echo "‚è≠Ô∏è Skipping pre-commit checks in CI environment"
  exit 0
fi

# Skip formatting and linting for release commits (check multiple patterns)
commit_message=$(git log -1 --pretty=format:"%s" 2>/dev/null || echo "")
if echo "$commit_message" | grep -qE "(chore\(release\)|üîñ.*chore\(release\)|\[skip ci\])"; then
  echo "‚è≠Ô∏è Skipping pre-commit checks for release commit"
  exit 0
fi

# Skip if semantic-release is running
if [ -n "$SEMANTIC_RELEASE" ] || [ -n "$SEMANTIC_RELEASE_DRY_RUN" ]; then
  echo "‚è≠Ô∏è Skipping pre-commit checks for semantic-release"
  exit 0
fi

# Lint and format staged files
npm run lint:staged

# Run tests
npm run test:pre-commit
