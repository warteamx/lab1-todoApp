# Coverage Badge Fix Documentation

## Issues Identified

1. **Client Coverage Never Uploaded**: The CI/CD workflow was only uploading server coverage to Codecov
2. **Missing LCOV Format for Server**: Vitest wasn't configured to generate `lcov.info` files
3. **Inconsistent Coverage Configuration**: Jest and Vitest had different coverage setups

## Solutions Implemented

### 1. Fixed Vitest Configuration (`server/vitest.config.ts`)

- Added explicit coverage configuration with LCOV reporter
- Configured exclusions for test files, config files, and build artifacts
- Added multiple reporter formats (text, html, clover, json, lcov)

### 2. Updated CI/CD Workflow (`.github/workflows/ci-cd.yml`)

- Removed the `if: matrix.package == 'server'` condition from coverage upload
- Updated to codecov-action@v4 (latest version)
- Added CODECOV_TOKEN requirement for better security
- Now uploads both client and server coverage with proper flags

### 3. Enhanced Jest Configuration (`client/package.json`)

- Added explicit `collectCoverageFrom` patterns
- Added `coverageReporters` configuration
- Excluded test files, config files, and assets from coverage

### 4. Added Codecov Configuration (`codecov.yml`)

- Configured proper flag handling for client/server separation
- Set coverage thresholds and behavior
- Added path-based flag assignment

## Required GitHub Secrets

Ensure the following secret is configured in your GitHub repository:

- `CODECOV_TOKEN`: Your Codecov upload token

## Badge URLs

The coverage badges in README.md use these URLs:

- Client: `https://img.shields.io/codecov/c/github/warteamx/lab1-todoApp?flag=client`
- Server: `https://img.shields.io/codecov/c/github/warteamx/lab1-todoApp?flag=server`

## Testing the Fix

After merging this branch to main:

1. The CI/CD pipeline will upload both client and server coverage
2. Codecov will process the coverage with proper flags
3. The badges should display the correct coverage percentages

## Coverage File Locations

- **Client**: `client/coverage/lcov.info` (generated by Jest)
- **Server**: `server/coverage/lcov.info` (generated by Vitest)

Both files are now properly generated and uploaded to Codecov with appropriate flags for separate tracking.
